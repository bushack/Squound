<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:custom="clr-namespace:SquoundApp.Custom"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:views="clr-namespace:SquoundApp.Views"
             xmlns:viewmodels="clr-namespace:SquoundApp.ViewModels"
             x:Class="SquoundApp.Pages.ItemDetailPage"
             x:DataType="viewmodels:ItemDetailViewModel">

    <Grid>

        <!-- Page content -->
        <ScrollView IsEnabled="{Binding IsNotBusy}"
                    IsVisible="{Binding IsNotBusy}">

            <VerticalStackLayout>
                <views:BasicHeaderView/>

                <!-- Carousel of images -->
                <CarouselView ItemsSource="{Binding Item.ImageUrls}"
                              IndicatorView="Indicator"
                              HorizontalOptions="Fill"
                              Margin="0, 0, 0, 10"
                              PeekAreaInsets="0">

                    <CarouselView.ItemsLayout>
                        <LinearItemsLayout Orientation="Horizontal"
                                            ItemSpacing="0"
                                            SnapPointsType="MandatorySingle"
                                            SnapPointsAlignment="Start"/>
                    </CarouselView.ItemsLayout>

                    <CarouselView.ItemTemplate>
                        <DataTemplate x:DataType="x:String">
                            <Image Source="{Binding .}"
                                    Aspect="AspectFill"
                                    HorizontalOptions="Fill"
                                    VerticalOptions="Fill"/>
                        </DataTemplate>
                    </CarouselView.ItemTemplate>
                </CarouselView>

                <IndicatorView x:Name="Indicator"
                               IndicatorColor="{StaticResource Gray200}"
                               SelectedIndicatorColor="{StaticResource SquoundTangerine}"
                               HorizontalOptions="Center"
                               Margin="0, 0, 0, 10"/>

                <!-- Grid for Name + Manufacturer (Left) and Price (Right) -->
                <Grid ColumnDefinitions="*, Auto"
                      RowDefinitions="Auto">

                    <!-- Name + Manufacturer (Left Column) -->
                    <VerticalStackLayout Grid.Column="0">
                        <Label Style="{StaticResource Headline}"
                               Text="{Binding Item.Name}"/>
                        <Label Style="{StaticResource SubHeadline}"
                               Text="{Binding Item.Manufacturer}"/>
                    </VerticalStackLayout>

                    <!-- Price (Right Column) -->
                    <Label Style="{StaticResource Headline}"
                            Text="{Binding Item.Price, StringFormat='{0:C}'}"
                            HorizontalOptions="End"
                            HorizontalTextAlignment="End"
                            Margin="20, 0, 20, 5"
                            Grid.Column="1"/>
                </Grid>

                <!-- Description -->
                <Label Style="{StaticResource MediumText}"
                       Text="{Binding Item.Description}"
                       BackgroundColor="Transparent"
                       IsVisible="True"/>

                <!-- Material -->
                <Label Style="{StaticResource MediumText}"
                       Text="{Binding Material}"
                       BackgroundColor="Transparent"
                       IsVisible="{Binding HasMaterial}"/>

                <!-- Dimensions -->
                <Label Style="{StaticResource MediumText}"
                       Text="{Binding Dimensions}"
                       BackgroundColor="Transparent"
                       IsVisible="{Binding HasDimensions}"/>

                <!-- Contact us -->
                <Label Style="{StaticResource MediumText}"
                       Text="Contact us about this item"
                       BackgroundColor="Transparent"
                       HorizontalOptions="Center"
                       Margin="0, 0, 0, 5"/>

                <!-- Contact buttons -->
                <FlexLayout HorizontalOptions="Fill"
                            VerticalOptions="Center"
                            JustifyContent="SpaceEvenly"
                            BackgroundColor="Transparent"
                            HeightRequest="50"
                            Margin="0, 0, 0, 10">

                    <!-- Call -->
                    <custom:HyperlinkImageButton x:Name="CallButton" Source="call.png" Padding="10" CornerRadius="20">
                        <custom:HyperlinkImageButton.Behaviors>
                            <toolkit:IconTintColorBehavior TintColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />
                        </custom:HyperlinkImageButton.Behaviors>
                    </custom:HyperlinkImageButton>

                    <!-- Email -->
                    <custom:HyperlinkImageButton x:Name="EmailButton" Source="email.png" Padding="10" CornerRadius="20" Url="{Binding EmailUrl}">
                        <custom:HyperlinkImageButton.Behaviors>
                            <toolkit:IconTintColorBehavior TintColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />
                        </custom:HyperlinkImageButton.Behaviors>
                    </custom:HyperlinkImageButton>

                    <!-- WhatsApp -->
                    <custom:HyperlinkImageButton x:Name="WhatsAppButton" Source="whatsapp.png" Padding="10" CornerRadius="20" Url="{Binding WhatsAppUrl}">
                        <custom:HyperlinkImageButton.Behaviors>
                            <toolkit:IconTintColorBehavior TintColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />
                        </custom:HyperlinkImageButton.Behaviors>
                    </custom:HyperlinkImageButton>
                </FlexLayout>

                <!-- Footer -->
                <views:FooterView/>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Loading indicator -->
        <views:LoadingOverlayView x:DataType="{Binding .}"/>

    </Grid>
</ContentPage>
